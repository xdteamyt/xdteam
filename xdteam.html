<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XD TEAM Official</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0c10; --panel:#12131a; --panel2:#161822; --text:#ffffff;
  --muted:#aeb3c2; --accent:#5c7cff; --live:#ff2b2b; --today:#ffffff;
  --past:#555861; --surgery:#2ecc71;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:radial-gradient(circle at top left,#15172a,#0b0c10 60%);color:var(--text);-webkit-font-smoothing:antialiased}

/* Layout */
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:linear-gradient(180deg,#0e1020,#0b0c10);border-right:1px solid rgba(255,255,255,.06);padding:20px;position:sticky;top:0}
.logo{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.logo img{width:56px;height:56px;border-radius:12px;object-fit:cover}
.logo span{font-weight:900;font-size:1.05rem}
.nav a{display:block;padding:10px 12px;margin-bottom:8px;border-radius:10px;color:var(--text);text-decoration:none;font-weight:700}
.nav a:hover{background:var(--panel2);transform:translateX(4px)}
.controls{margin-top:12px;display:flex;flex-direction:column;gap:8px}

/* Main */
main{padding:22px 28px 80px}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px}
.clock{font-weight:900;font-size:1.15rem}
.tz{color:var(--muted);font-size:.95rem}
.hero{padding:10px 0}
.hero h1{font-size:1.9rem;margin:0}
.hero p{color:var(--muted);margin-top:8px}

/* Sections */
.section{margin-top:26px}
.section h2{font-size:1.3rem;margin-bottom:12px}

/* Videos */
.video-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
iframe{width:100%;height:180px;border-radius:12px;border:none}

/* Calendar */
.calendar-wrap{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
.calendar-side img{width:240px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}
.calendar-main{flex:1;min-width:280px}
.cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cal-head .year{font-size:1.2rem;font-weight:900}
.cal-head .week{color:var(--muted);font-weight:800}
.cal-nav button{background:var(--panel);border:1px solid rgba(255,255,255,.06);color:#fff;border-radius:10px;padding:8px 10px;font-weight:900;cursor:pointer}
.weekdays,.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
.weekday{text-align:center;color:var(--muted);font-size:.85rem}
.day{background:linear-gradient(180deg,#141626,#181a2e);padding:12px;border-radius:12px;min-height:96px;text-align:center;transition:.24s;display:flex;flex-direction:column;justify-content:center;align-items:center}
.day:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(0,0,0,.6)}
.day-name{font-weight:900}
.day-date{font-size:.85rem;color:var(--muted);margin-top:6px}
.day.today{background:var(--today);color:#000;box-shadow:0 8px 24px rgba(0,0,0,.12)}
.day.past{background:linear-gradient(180deg,#4b4e58,#3a3d46);color:#d6d6d6}
.day.saturday{background:linear-gradient(180deg,#ff2b2b,#d91c1c);color:#fff;font-weight:900}
.day.surgery{background:linear-gradient(180deg,#2ecc71,#27ae60);color:#022;font-weight:900}
.badge{margin-top:8px;padding:6px 8px;border-radius:8px;font-size:.78rem;font-weight:900}
.stream{background:#ff3b3b;color:#fff}
.surg{background:#1f9d55;color:#022}

/* Team + links */
.team-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.member{display:block;background:var(--panel2);padding:14px;border-radius:14px;color:#fff;text-decoration:none;border:1px solid rgba(255,255,255,.03);position:relative}

/* Contact */
.contact-box{background:var(--panel2);padding:14px;border-radius:14px}

/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2000}
.modal{background:#0f1116;padding:18px;border-radius:12px;min-width:320px;border:1px solid rgba(255,255,255,.04)}
.input{width:100%;padding:10px;border-radius:8px;background:#0c0d12;border:1px solid rgba(255,255,255,.03);color:#fff;margin-bottom:10px}

/* fireworks */
#fireworks{position:fixed;inset:0;pointer-events:none;display:none;z-index:1500}
#newyear{position:fixed;left:50%;top:40%;transform:translateX(-50%);font-size:2.8rem;font-weight:900;display:none;z-index:1600;color:#fff;text-shadow:0 0 30px #fff}

/* Responsive */
@media(max-width:900px){.app{grid-template-columns:1fr}.sidebar{position:relative}.calendar-side img{width:100%}}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="logo">
      <img src="xdteamlogo.JPEG" alt="XD logo">
      <span data-i18n="siteTitle">XD TEAM</span>
    </div>

    <nav class="nav" aria-label="F≈ë navig√°ci√≥">
      <a href="#videos" data-i18n="navVideos">Vide√≥k</a>
      <a href="#calendar" data-i18n="navCalendar">Kalend√°rium</a>
      <a href="#team" data-i18n="navTeam">Csapat</a>
      <a href="#schedule" data-i18n="navSchedule">Menetrend</a>
      <a href="#contact" data-i18n="navContact">Kapcsolat</a>
      <a href="#links" data-i18n="navLinks">Csatorn√°k</a>
    </nav>

    <div class="controls" aria-hidden="false">
      <label for="langSelect" class="small">Lang</label>
      <select id="langSelect" aria-label="Nyelv">
        <option value="hu">Magyar</option>
        <option value="en">English</option>
        <option value="de">Deutsch</option>
        <option value="hr">Hrvatski</option>
      </select>

      <label for="tzSelect" class="small">TZ</label>
      <select id="tzSelect" aria-label="Id≈ëz√≥na">
        <option value="Europe/Budapest">Europe/Budapest</option>
        <option value="Europe/Berlin">Europe/Berlin</option>
        <option value="Europe/London">Europe/London</option>
        <option value="America/New_York">America/New_York</option>
      </select>

      <button id="loginBtn" class="small" style="margin-top:8px">Admin bejelentkez√©s</button>
      <a id="adminPanelLink" class="small" style="display:none;margin-top:6px;cursor:pointer">Admin panel</a>
      <div class="small" style="margin-top:12px">Csak adminok jelentkezhetnek be. Nincs regisztr√°ci√≥.</div>
    </div>
  </aside>

  <main>
    <div class="topbar">
      <div>
        <div class="clock" id="clock">--:--:--</div>
        <div class="tz" id="tzLabel">Europe/Budapest</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:900">XD TEAM Official</div>
        <div style="color:var(--muted);font-size:0.95rem" data-i18n="heroText">Szombaton 10:00‚Äì15:00 ‚Ä¢ GTA ‚Ä¢ Minecraft ‚Ä¢ Fortnite</div>
      </div>
    </div>

    <section class="hero" aria-labelledby="heroTitle">
      <h1 id="heroTitle" data-i18n="heroHeadline">√údv az XD TEAM oldal√°n!</h1>
      <p data-i18n="heroSub">K√∂z√∂ss√©g, streamek √©s minden inf√≥ egy helyen.</p>
    </section>

    <div class="section" id="videos">
      <h2 data-i18n="videosHeading">Vide√≥k</h2>
      <div class="video-grid">
        <iframe src="https://www.youtube.com/embed/Hux5gHJczxo" title="VID1" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/eqF-AnPPdq0" title="VID2" allowfullscreen></iframe>
      </div>
    </div>

    <div class="section" id="calendarSection" aria-labelledby="calendarHeading">
      <h2 id="calendarHeading" data-i18n="calendarHeading">Kalend√°rium & √≥ra</h2>

      <div class="calendar-wrap">
        <div class="calendar-side">
          <img src="Calendar.png" alt="Calendar">
        </div>

        <div class="calendar-main">
          <div class="cal-head">
            <div>
              <div class="year" id="calendarYear"></div>
              <div class="week" id="weekLabel"></div>
            </div>
            <div class="cal-nav">
              <button id="prevWeek" aria-label="El≈ëz≈ë h√©t">‚óÄ</button>
              <button id="nextWeek" aria-label="K√∂vetkez≈ë h√©t">‚ñ∂</button>
            </div>
          </div>

          <div class="weekdays" id="weekdaysHeader" aria-hidden="true"></div>
          <div class="week-grid" id="weekGrid" role="grid" aria-label="Heti napt√°r"></div>

          <div style="margin-top:10px;color:var(--muted)" id="calendarNote" data-i18n="calendarNote">Napt√°r: 2025.12.30 ‚Äì 2027.01.01</div>
        </div>
      </div>
    </div>

    <div class="section" id="team">
      <h2 data-i18n="teamHeading">Csapat</h2>
      <div class="team-grid">
        <a class="member" id="botixdBtn" href="https://youtube.com/@botixd_official?si=UHo64N7xdasRaLA2" target="_blank" rel="noopener noreferrer">
          <h3>BotiXD</h3><p>Alap√≠t√≥ / Streamer</p>
        </a>
        <a class="member" href="https://youtube.com/@gaming1110_yt?si=1aD2qE0wPr-OAHvb" target="_blank"><h3>Gaming1110</h3></a>
        <a class="member" href="https://youtube.com/@patrikopik?si=P4E8wkM2rIDB717_" target="_blank"><h3>PatrikOpik</h3></a>
      </div>
    </div>

    <div class="section" id="schedule">
      <h2 data-i18n="scheduleHeading">Stream menetrend</h2>
      <ul>
        <li>üéÆ <span data-i18n="satGames">Szombat ‚Äì GTA, Minecraft, Fortnite (BotiXD)</span></li>
        <li>‚è∞ <span data-i18n="satTime">10:00 ‚Äì 15:00</span></li>
      </ul>
    </div>

    <div class="section" id="links">
      <h2 data-i18n="channelsTitle">Csatorn√°ink & k√∂z√∂ss√©g</h2>
      <div class="team-grid">
        <a class="member" href="https://youtube.com/@xdteam_official?si=5phdzFtMVx3Zso_D" target="_blank"><h3>XD TEAM</h3><p>YouTube ‚Äì Hivatalos csatorna</p></a>
        <a class="member" href="https://youtube.com/@botixd_official?si=UHo64N7xdasRaLA2" target="_blank"><h3>BotiXD</h3><p>YouTube ‚Äì Streamer</p></a>
        <a class="member" href="https://youtube.com/@gaming1110_yt?si=1aD2qE0wPr-OAHvb" target="_blank"><h3>Gaming1110</h3><p>YouTube</p></a>
        <a class="member" href="https://youtube.com/@patrikopik?si=P4E8wkM2rIDB717_" target="_blank"><h3>PatrikOpik</h3><p>YouTube</p></a>
        <a class="member" href="https://discord.com/invite/pEJwrqW7nK" target="_blank"><h3>Discord szerver</h3><p>K√∂z√∂ss√©g ‚Ä¢ Chat ‚Ä¢ √ârtes√≠t√©sek</p></a>
      </div>
    </div>

    <div class="section" id="contact">
      <h2 data-i18n="contactHeading">Kapcsolat</h2>
      <div class="contact-box">
        <p class="small" data-i18n="contactText">Ha b√°rmi baj van vagy szeretn√©l csatlakozni: <strong>xdteam303@gmail.com</strong></p>
        <a class="small" href="mailto:xdteam303@gmail.com" style="text-decoration:none;color:var(--accent)" data-i18n="emailBtn">üìß √çr√°s Gmailben</a>
        <a class="small" href="XD_TEAM_Csatlakozas.docx" download style="margin-left:12px;text-decoration:none;color:#fff" data-i18n="docxBtn">üìÑ Csatlakoz√°si √∫tmutat√≥ let√∂lt√©se</a>

        <h3 style="margin-top:14px" data-i18n="howToTitle">Hogyan csatlakozz?</h3>
        <ol style="color:var(--muted);margin-top:8px;">
          <li data-i18n="step1">Kattints az ‚Äû√çr√°s Gmailben‚Äù gombra.</li>
          <li data-i18n="step2">T√∂ltsd ki: n√©v, kor, j√°t√©kok, tapasztalat.</li>
          <li data-i18n="step3">Ha van YouTube/Twitch, linkeld be.</li>
          <li data-i18n="step4">K√ºldd el ‚Äî v√°laszunk hamarosan √©rkezik.</li>
        </ol>
      </div>
    </div>
  </main>
</div>

<!-- Admin modal -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h3 id="loginTitle">Admin bejelentkez√©s</h3>
    <input id="usernameInput" class="input" placeholder="Felhaszn√°l√≥" autocomplete="username">
    <input id="passwordInput" class="input" placeholder="Jelsz√≥" type="password" autocomplete="current-password">
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button id="cancelLogin" class="small">M√©gse</button>
      <button id="submitLogin" class="small" style="background:var(--accent);color:#000">Bejelentkez√©s</button>
    </div>
    <p class="small" style="margin-top:10px;color:var(--muted)">Figyelem: kliens-oldali demo hiteles√≠t√©s. √âles √ºzemn√©l szerver-oldali auth javasolt.</p>
  </div>
</div>

<!-- Fireworks + NewYear -->
<canvas id="fireworks"></canvas>
<div id="newyear" aria-hidden="true">üéÜ BOLDOG √öJ √âVET! üéÜ</div>

<!-- Midnight audio (kept) -->
<audio id="midnightAudio" src="Midnightcity.mp3" preload="auto"></audio>

<script>
/* ================= CONFIG / TRANSLATIONS ================= */
const i18n = {
  hu: {
    siteTitle: "XD TEAM",
    navVideos: "Vide√≥k",
    navCalendar: "Kalend√°rium",
    navTeam: "Csapat",
    navSchedule: "Menetrend",
    navContact: "Kapcsolat",
    navLinks: "Csatorn√°k",
    heroText: "Szombaton 10:00‚Äì15:00 ‚Ä¢ GTA ‚Ä¢ Minecraft ‚Ä¢ Fortnite",
    heroHeadline: "√údv az XD TEAM oldal√°n!",
    heroSub: "K√∂z√∂ss√©g, streamek √©s minden inf√≥ egy helyen.",
    videosHeading: "Vide√≥k",
    calendarHeading: "Kalend√°rium & √≥ra",
    calendarNote: "Napt√°r: 2025.12.30 ‚Äì 2027.01.01",
    teamHeading: "Csapat",
    scheduleHeading: "Stream menetrend",
    satGames: "Szombat ‚Äì GTA, Minecraft, Fortnite (BotiXD)",
    satTime: "10:00 ‚Äì 15:00",
    channelsTitle: "Csatorn√°ink & k√∂z√∂ss√©g",
    contactHeading: "Kapcsolat",
    contactText: "Ha b√°rmi baj van vagy szeretn√©l csatlakozni: <strong>xdteam303@gmail.com</strong>",
    emailBtn: "üìß √çr√°s Gmailben",
    docxBtn: "üìÑ Csatlakoz√°si √∫tmutat√≥ let√∂lt√©se",
    howToTitle: "Hogyan csatlakozz?",
    step1: "Kattints az ‚Äû√çr√°s Gmailben‚Äù gombra.",
    step2: "T√∂ltsd ki: n√©v, kor, j√°t√©kok, tapasztalat.",
    step3: "Ha van YouTube/Twitch, linkeld be.",
    step4: "K√ºldd el ‚Äî v√°laszunk hamarosan √©rkezik.",
    channelsTitleShort: "Csatorn√°k"
  },
  en: {
    siteTitle: "XD TEAM",
    navVideos: "Videos",
    navCalendar: "Calendar",
    navTeam: "Team",
    navSchedule: "Schedule",
    navContact: "Contact",
    navLinks: "Channels",
    heroText: "Saturday 10:00‚Äì15:00 ‚Ä¢ GTA ‚Ä¢ Minecraft ‚Ä¢ Fortnite",
    heroHeadline: "Welcome to the XD TEAM site!",
    heroSub: "Community, streams and all info in one place.",
    videosHeading: "Videos",
    calendarHeading: "Calendar & clock",
    calendarNote: "Calendar: 2025.12.30 ‚Äì 2027.01.01",
    teamHeading: "Team",
    scheduleHeading: "Stream schedule",
    satGames: "Saturday ‚Äì GTA, Minecraft, Fortnite (BotiXD)",
    satTime: "10:00 ‚Äì 15:00",
    channelsTitle: "Our channels & community",
    contactHeading: "Contact",
    contactText: "If you need help or want to join: <strong>xdteam303@gmail.com</strong>",
    emailBtn: "üìß Write in Gmail",
    docxBtn: "üìÑ Download join guide",
    howToTitle: "How to join?",
    step1: "Click the 'Write in Gmail' button.",
    step2: "Fill: name, age, games, experience.",
    step3: "Add YouTube/Twitch link if any.",
    step4: "Send ‚Äî we'll reply soon."
  },
  de: {
    siteTitle: "XD TEAM",
    navVideos: "Videos",
    navCalendar: "Kalender",
    navTeam: "Team",
    navSchedule: "Zeitplan",
    navContact: "Kontakt",
    navLinks: "Kan√§le",
    heroText: "Samstag 10:00‚Äì15:00 ‚Ä¢ GTA ‚Ä¢ Minecraft ‚Ä¢ Fortnite",
    heroHeadline: "Willkommen auf der XD TEAM Seite!",
    heroSub: "Community, Streams und alle Infos an einem Ort.",
    videosHeading: "Videos",
    calendarHeading: "Kalender & Uhr",
    calendarNote: "Kalender: 2025.12.30 ‚Äì 2027.01.01",
    teamHeading: "Team",
    scheduleHeading: "Stream-Zeitplan",
    satGames: "Samstag ‚Äì GTA, Minecraft, Fortnite (BotiXD)",
    satTime: "10:00 ‚Äì 15:00",
    channelsTitle: "Unsere Kan√§le & Community",
    contactHeading: "Kontakt",
    contactText: "Wenn du Hilfe brauchst oder beitreten m√∂chtest: <strong>xdteam303@gmail.com</strong>",
    emailBtn: "üìß In Gmail schreiben",
    docxBtn: "üìÑ Join-Anleitung herunterladen",
    howToTitle: "Wie beitreten?",
    step1: "Klicke den 'In Gmail schreiben' Button.",
    step2: "F√ºlle: Name, Alter, Spiele, Erfahrung.",
    step3: "F√ºge YouTube/Twitch-Link bei, falls vorhanden.",
    step4: "Sende ‚Äî wir antworten bald."
  },
  hr: {
    siteTitle: "XD TEAM",
    navVideos: "Videozapisi",
    navCalendar: "Kalendar",
    navTeam: "Tim",
    navSchedule: "Raspored",
    navContact: "Kontakt",
    navLinks: "Kanali",
    heroText: "Subota 10:00‚Äì15:00 ‚Ä¢ GTA ‚Ä¢ Minecraft ‚Ä¢ Fortnite",
    heroHeadline: "Dobrodo≈°li na XD TEAM stranicu!",
    heroSub: "Zajednica, streamovi i sve informacije na jednom mjestu.",
    videosHeading: "Videozapisi",
    calendarHeading: "Kalendar & sat",
    calendarNote: "Kalendar: 2025.12.30 ‚Äì 2027.01.01",
    teamHeading: "Tim",
    scheduleHeading: "Raspored streamova",
    satGames: "Subota ‚Äì GTA, Minecraft, Fortnite (BotiXD)",
    satTime: "10:00 ‚Äì 15:00",
    channelsTitle: "Na≈°i kanali i zajednica",
    contactHeading: "Kontakt",
    contactText: "Ako treba≈° pomoƒá ili ≈æeli≈° pridru≈æiti se: <strong>xdteam303@gmail.com</strong>",
    emailBtn: "üìß Pi≈°i u Gmail",
    docxBtn: "üìÑ Preuzmi vodiƒç za pridru≈æivanje",
    howToTitle: "Kako se pridru≈æiti?",
    step1: "Klikni 'Pi≈°i u Gmail' gumb.",
    step2: "Ispuni: ime, godine, igre, iskustvo.",
    step3: "Dodaj YouTube/Twitch link ako ima≈°.",
    step4: "Po≈°alji ‚Äî odgovoriti ƒáemo uskoro."
  }
};

/* Special date config */
const SPECIAL_DAYS = {
  "2025-12-31": { hu: "Szilveszter / STREAM", en: "New Year's Eve / STREAM", de: "Silvester / STREAM", hr: "Doƒçek / STREAM" },
  "2026-01-01": { hu: "√öj√©v / STREAM", en: "New Year / STREAM", de: "Neujahr / STREAM", hr: "Nova godina / STREAM" }
};
const SURG_START = '2026-01-13', SURG_END = '2026-01-16';
const RANGE_START = new Date(Date.UTC(2025,11,30));
const RANGE_END   = new Date(Date.UTC(2027,0,1));

/* Admin demo credentials (client-side demo only) */
const ADMIN_CREDENTIALS = { "BotiXD":"Botigame235", "Gaming1110":"Gaming1110_372!?", "PatrikOpik":"Kugli32!+" };

/* State */
let lang = localStorage.getItem('xd_lang') || 'hu';
let tz = localStorage.getItem('xd_tz') || 'Europe/Budapest';
let weekOffset = 0;
let forcedSurgery = null;

/* Elements */
const midnightAudio = document.getElementById('midnightAudio');

/* ================= HELPERS ================= */
function applyLanguage(l){
  lang = l;
  localStorage.setItem('xd_lang', l);
  document.documentElement.lang = l;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    if(i18n[l] && i18n[l][key]) el.innerHTML = i18n[l][key];
  });
  // ensure calendar text updates (dates use locale automatically)
  renderWeek();
}
document.getElementById('langSelect').addEventListener('change', e=> applyLanguage(e.target.value));

document.getElementById('tzSelect').addEventListener('change', e=>{
  tz = e.target.value;
  localStorage.setItem('xd_tz', tz);
  updateClock();
  renderWeek();
});

/* Date/time helpers */
function isoYMD(date=new Date()){
  return new Intl.DateTimeFormat('en-CA',{timeZone:tz}).format(date);
}
function timeHM(date=new Date()){
  return new Intl.DateTimeFormat('en-GB',{timeZone:tz,hour:'2-digit',minute:'2-digit',hour12:false}).format(date);
}
function getWeekStartUTCForTZ(date){
  const parts = new Intl.DateTimeFormat('en-CA',{timeZone:tz}).formatToParts(date).reduce((a,p)=>{ if(p.type!=='literal') a[p.type]=p.value; return a; }, {});
  const utc = new Date(Date.UTC(Number(parts.year), Number(parts.month)-1, Number(parts.day)));
  const wd = new Intl.DateTimeFormat('en-US',{timeZone:tz,weekday:'short'}).format(utc);
  const map = {'Mon':1,'Tue':2,'Wed':3,'Thu':4,'Fri':5,'Sat':6,'Sun':7};
  const num = map[wd] || 1;
  const delta = (num + 6) % 7;
  utc.setUTCDate(utc.getUTCDate() - delta);
  return utc;
}
function getISOWeekNumberUTC(dUTC){
  const tmp = new Date(Date.UTC(dUTC.getUTCFullYear(), dUTC.getUTCMonth(), dUTC.getUTCDate()));
  tmp.setUTCDate(tmp.getUTCDate() + 4 - (tmp.getUTCDay()||7));
  const yearStart = new Date(Date.UTC(tmp.getUTCFullYear(),0,1));
  return Math.ceil((((tmp - yearStart)/86400000)+1)/7);
}

/* ================= CLOCK & MIDNIGHT AUDIO ================= */
function updateClock(){
  const now = new Date();
  const timeStr = new Intl.DateTimeFormat(lang, { timeZone: tz, hour:'2-digit',minute:'2-digit',second:'2-digit', hour12:false }).format(now);
  document.getElementById('clock').textContent = timeStr;
  document.getElementById('tzLabel').textContent = tz;

  const todayISO = isoYMD(now);
  const hm = timeHM(now);

  // Play Midnightcity.mp3 at 2025-12-31 23:50 (tz)
  if(todayISO === '2025-12-31' && hm === '23:50'){
    try{ midnightAudio.play().catch(()=>{}); }catch(e){}
  }

  // New Year fireworks at 2026-01-01 00:00 (tz)
  if(todayISO === '2026-01-01' && hm === '00:00'){
    showNewYear();
  }

  // If inside special skip-days, stop audio except scheduled moment
  if((todayISO === '2025-12-31' || todayISO === '2026-01-01') && !(todayISO==='2025-12-31' && hm==='23:50')){
    if(!midnightAudio.paused){ midnightAudio.pause(); midnightAudio.currentTime=0; }
  }
}
setInterval(updateClock,1000);
updateClock();

/* ================= CALENDAR RENDER ================= */
function renderWeek(){
  const grid = document.getElementById('weekGrid');
  const weekdaysHeader = document.getElementById('weekdaysHeader');
  grid.innerHTML=''; weekdaysHeader.innerHTML='';

  const now = new Date();
  let baseMonUTC = getWeekStartUTCForTZ(now);
  baseMonUTC.setUTCDate(baseMonUTC.getUTCDate() + weekOffset*7);

  if(baseMonUTC < RANGE_START) baseMonUTC = getWeekStartUTCForTZ(RANGE_START);
  if(baseMonUTC > RANGE_END) baseMonUTC = getWeekStartUTCForTZ(RANGE_END);

  const displayYear = new Intl.DateTimeFormat(lang, { timeZone: tz, year:'numeric' }).format(baseMonUTC);
  document.getElementById('calendarYear').textContent = displayYear;
  const weekNo = getISOWeekNumberUTC(baseMonUTC);
  document.getElementById('weekLabel').textContent = (lang === 'hu' ? 'H√©t: ' : 'Week: ') + weekNo;

  const weekdayOrder = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  weekdayOrder.forEach((w, idx)=>{
    const d = new Date(baseMonUTC); d.setUTCDate(d.getUTCDate() + idx);
    const label = new Intl.DateTimeFormat(lang, { timeZone: tz, weekday:'short' }).format(d);
    const el = document.createElement('div'); el.className='weekday'; el.textContent = label;
    weekdaysHeader.appendChild(el);
  });

  const todayISO = isoYMD(new Date());

  for(let i=0;i<7;i++){
    const dUTC = new Date(baseMonUTC); dUTC.setUTCDate(dUTC.getUTCDate() + i);
    const dISO = isoYMD(dUTC);
    const weekdayShort = new Intl.DateTimeFormat('en-US', { timeZone: tz, weekday:'short' }).format(dUTC);
    const inRange = (dUTC >= RANGE_START && dUTC <= RANGE_END);

    const cell = document.createElement('div'); cell.className = 'day';
    if(!inRange){
      cell.classList.add('past');
      cell.innerHTML = `<div class="day-name">‚Äî</div><div class="day-date">‚Äî</div>`;
      grid.appendChild(cell);
      continue;
    }

    const isSurgeryAuto = (dISO >= SURG_START && dISO <= SURG_END);
    const isSurgery = forcedSurgery === true ? true : (forcedSurgery === false ? false : isSurgeryAuto);

    const special = SPECIAL_DAYS[dISO];

    // apply styles
    if(dISO === todayISO) cell.classList.add('today');
    else if(isSurgery) cell.classList.add('surgery');
    else if(dISO < todayISO) cell.classList.add('past');
    else if(weekdayShort === 'Sat') cell.classList.add('saturday');

    const dayName = new Intl.DateTimeFormat(lang, { timeZone: tz, weekday:'long' }).format(dUTC);
    const dayFull = new Intl.DateTimeFormat(lang, { timeZone: tz, year:'numeric', month:'long', day:'numeric' }).format(dUTC);
    cell.innerHTML = `<div class="day-name">${dayName}</div><div class="day-date">${dayFull}</div>`;

    if(isSurgery){
      const b = document.createElement('div'); b.className='badge surg';
      b.textContent = (lang==='hu' ? 'BotiXD nem el√©rhet≈ë' : (lang==='de' ? 'BotiXD nicht erreichbar' : (lang==='hr' ? 'BotiXD nije dostupan' : 'BotiXD unavailable')));
      cell.appendChild(b);
    } else if(special){
      const text = special[lang] || special.hu;
      const b = document.createElement('div'); b.className='badge stream'; b.textContent = text;
      cell.appendChild(b);
    } else if(weekdayShort === 'Sat' && dISO >= todayISO){
      const b = document.createElement('div'); b.className='badge stream'; b.textContent = (lang==='hu'?'STREAM':'STREAM');
      cell.appendChild(b);
    }

    grid.appendChild(cell);
  }

  // BotiXD pill
  const memberBoti = document.getElementById('botixdBtn') || document.getElementById('memberBoti');
  if(memberBoti){
    Array.from(memberBoti.querySelectorAll('.badge.surg')).forEach(n=>n.remove());
    const todayStr = isoYMD(new Date());
    const activeSurgery = forcedSurgery === true ? true : (forcedSurgery === false ? false : (todayStr >= SURG_START && todayStr <= SURG_END));
    if(activeSurgery){
      const pill = document.createElement('div'); pill.className='badge surg'; pill.style.position='absolute'; pill.style.right='12px'; pill.style.top='12px';
      pill.textContent = (lang==='hu' ? 'BotiXD nem el√©rhet≈ë' : (lang==='de' ? 'BotiXD nicht erreichbar' : (lang==='hr' ? 'BotiXD nije dostupan' : 'BotiXD unavailable')));
      memberBoti.appendChild(pill);
    }
  }
}

/* week nav */
document.getElementById('prevWeek').addEventListener('click', ()=>{ weekOffset -= 1; renderWeek(); });
document.getElementById('nextWeek').addEventListener('click', ()=>{ weekOffset += 1; renderWeek(); });

/* ================= New Year fireworks ================= */
function showNewYear(){
  const txt = document.getElementById('newyear');
  txt.style.display='block';
  launchFireworks();
  setTimeout(()=> txt.style.display='none', 12000);
}
function launchFireworks(){
  const canvas = document.getElementById('fireworks');
  canvas.style.display='block';
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = window.innerWidth+'px';
  canvas.style.height = window.innerHeight+'px';
  ctx.scale(dpr,dpr);
  let particles = [];
  function spawn(x,y){
    const cols = ['#ff3b3b','#ffd34d','#5c7cff','#7effc7','#ff7aa2'];
    for(let i=0;i<40;i++){
      particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()-1.5)*6,life:Math.random()*80+60,col:cols[Math.floor(Math.random()*cols.length)]});
    }
  }
  for(let i=0;i<8;i++) spawn(Math.random()*window.innerWidth, Math.random()*window.innerHeight*0.6);
  let raf;
  function step(){
    ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.life -= 1;
      ctx.beginPath(); ctx.fillStyle = p.col; ctx.globalAlpha = Math.max(0,p.life/100);
      ctx.arc(p.x,p.y,Math.max(0,p.life/12),0,Math.PI*2); ctx.fill();
      if(p.life<=0) particles.splice(i,1);
    }
    if(particles.length>0) raf = requestAnimationFrame(step);
    else{ cancelAnimationFrame(raf); canvas.style.display='none'; }
  }
  step();
}

/* ================= Admin modal (client demo) ================= */
const modal = document.getElementById('modalBackdrop');
const loginBtn = document.getElementById('loginBtn');
const adminPanelLink = document.getElementById('adminPanelLink');
const submitLogin = document.getElementById('submitLogin');
const cancelLogin = document.getElementById('cancelLogin');
const usernameInput = document.getElementById('usernameInput');
const passwordInput = document.getElementById('passwordInput');

if(loginBtn) loginBtn.addEventListener('click', ()=>{ usernameInput.value=''; passwordInput.value=''; modal.style.display='flex'; usernameInput.focus(); });
if(cancelLogin) cancelLogin.addEventListener('click', ()=> modal.style.display='none');

function setAdminState(username){
  sessionStorage.setItem('xd_admin', username);
  if(loginBtn) loginBtn.style.display='none';
  if(adminPanelLink) adminPanelLink.style.display='block';
  const adminArea = document.getElementById('adminArea'); if(adminArea) adminArea.style.display='block';
  const adminInfo = document.getElementById('adminInfo'); if(adminInfo) adminInfo.textContent = `Bejelentkezve: ${username}`;
  renderWeek();
}
function clearAdminState(){
  sessionStorage.removeItem('xd_admin');
  if(loginBtn) loginBtn.style.display='block';
  if(adminPanelLink) adminPanelLink.style.display='none';
  const adminArea = document.getElementById('adminArea'); if(adminArea) adminArea.style.display='none';
  const adminInfo = document.getElementById('adminInfo'); if(adminInfo) adminInfo.textContent = '';
  renderWeek();
}

if(document.getElementById('submitLogin')){
  document.getElementById('submitLogin').addEventListener('click', ()=>{
    const u = usernameInput.value.trim();
    const p = passwordInput.value;
    if(u && p && ADMIN_CREDENTIALS[u] && ADMIN_CREDENTIALS[u] === p){
      setAdminState(u);
      modal.style.display='none';
    } else alert('Hib√°s bel√©p√©si adatok.');
  });
}

// restore admin
(function(){ const adm = sessionStorage.getItem('xd_admin'); if(adm && ADMIN_CREDENTIALS[adm]) setAdminState(adm); else clearAdminState(); })();

/* admin surgery override (if adminArea present) */
const forceOn = document.getElementById('forceSurgOn');
const forceOff = document.getElementById('forceSurgOff');
if(forceOn) forceOn.addEventListener('click', ()=>{ if(!sessionStorage.getItem('xd_admin')) { alert('Csak admin haszn√°lhatja.'); return; } forcedSurgery=true; const am=document.getElementById('adminMessage'); if(am) am.textContent='M≈±t√©t manu√°lisan bekapcsolva (admin).'; renderWeek(); });
if(forceOff) forceOff.addEventListener('click', ()=>{ if(!sessionStorage.getItem('xd_admin')) { alert('Csak admin haszn√°lhatja.'); return; } forcedSurgery=false; const am=document.getElementById('adminMessage'); if(am) am.textContent='M≈±t√©t manu√°lisan kikapcsolva (admin).'; renderWeek(); });

/* ================= Init ================= */
document.getElementById('langSelect').value = lang;
document.getElementById('tzSelect').value = tz;
applyLanguage(localStorage.getItem('xd_lang') || lang);
renderWeek();

</script>
</body>
</html>